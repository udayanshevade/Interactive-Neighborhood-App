<!doctype html>
<html>

<head>
  <title>Neighborhood Map</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/main.css">
</head>

<!-- body -->
<body data-bind="css: { dark: currentMode() }">
  <i class="fa fa-spinner loading" data-bind="visible: loading"></i>
  <!-- map -->
  <div id="mapDiv" data-bind="css: { fade: alerting, fade: loading } "></div>

  <!-- location search input -->
  <header class="ui-overlay">
    <form class="ui-form" data-bind="submit: updateSearch">
      <!-- geo location -->
      <i class="icon fa fa-location-arrow locate-icon" data-bind="visible: navigator.geolocation, click: geoLocate"></i>
      <!-- search button -->
      <button class="icon search-button ui-search-focus" type="submit"><i class="fa fa-search search-icon"></i></button>
      <!-- search a term -->
      <input class="ui-search" type="text" data-bind="textInput: searchTerm, hasFocus: !placesExpanded()">

      <span class="search-in">in</span>
      <!-- search a location -->
      <input class="ui-search" type="text" data-bind="textInput: poi">

    </form>
    <!-- expand venues -->
    <i class="icon places-icon fa fa-caret-down" data-bind="visible: venuesArray, click: expandPlaces, css: { expandIcon: placesExpanded() }"></i>
  </header>

  <!-- places section -->
  <section class="places" data-bind="visible: placesExpanded" style="display:none">

    <!-- filter -->
    <header class="ui-filter-form">
      <i class="icon fa fa-filter filter-button"></i>
      <input class="ui-filter" type="text" data-bind="textInput: filterQuery, hasFocus: placesExpanded(), event: { keyup: filterVenues() }">
    </header>

    <div class="show-options">
      <!-- show all venues -->
      <h3 class="show-all" data-bind="click: showAll">show all</h3>
      <!-- show favorite venues -->
      <h3 class="show-favorites" data-bind="click: showFavorites">show favorites</h3>

    </div>

    <!-- venues list -->
    <ul class="places-list" data-bind="foreach: { data: venuesArray, as: 'venue' }">

      <!-- each venue -->
      <li class="place-list-item" data-bind="visible: venue.venueVisible, css: {placeListItemExpanded: venue.venueExpanded}">

        <header class="place-header" data-bind="click: $parent.toggleVenueExpand">

          <div class="place-name-wrapper">
            <!-- venues rating -->
            <h2 class="place-rating" data-bind="text: rating, css: { highRating: rating >= 8.75, goodRating: rating >= 8 && rating < 8.75, averageRating: rating >= 7 && rating < 8, lowRating: rating >= 6 && rating < 7, badRating: rating < 6}"></h2>
            <!-- venues name -->
            <h2 class="place-name" data-bind="text: name"></h2>
          </div>

          <div class="place-options">
            <!-- favorite option -->
            <i class="icon fa fa-star place-icon" data-bind="click: $parent.toggleVenueFavorite, css: { favorited: venue.favorited }"></i>
            <!-- marker icon -->
            <i class="icon fa fa-map-marker place-icon marker-icon" data-bind="click: $parent.chooseVenue"></i>
          </div>

        </header>

        <!-- expanded venues information -->
        <section class="place-info" data-bind="visible: venue.venueExpanded">
          <!-- place details -->
          <div class="info-wrapper">
            <h5 class="place-type" data-bind="text: venue.categories[0].name"></h5>

            <!-- place contact info -->
            <div class="contact">
              <!-- venue phone -->
              <h5 class="contact-text" data-bind="if: venue.contact.formattedPhone">
                <a class="contact-link" data-bind="attr: { href: 'tel:' + venue.contact.formattedPhone }">
                  <i class="fa fa-phone contact-icon"></i>
                </a>
              </h5>
              <!-- venue link -->
              <h5 class="contact-text" data-bind="if: venue.url">
                <a class="contact-link website-link" target="_blank" data-bind="attr: { href: venue.url }">
                  <i class="fa fa-link contact-icon website-icon"></i>
                </a>
              </h5>
            </div>
          </div>
          <!-- open status -->
          <h5 class="open-status" data-bind="style: { color: venue.hours.isOpen ? 'green' : 'red' }, text: venue.hours.status"></h5>

          <!-- foursquare logo link -->
          <a class="foursquare-link" data-bind="attr: { href: venue.FoursquareURL } ">
            <span class="foursquare-text">more on:</span>
            <img class="foursquare-logo" src="img/foursquare-logo.svg" alt="Foursquare Logo">
          </a>

          <!-- venues picture -->
          <div class="info-pic-wrapper">
            <div class="info-pic" data-bind="if: venue.photoURL">
              <i class="icon fa fa-caret-left" data-bind="click: function(data) { $parent.cyclePics('backwards', data) }"></i>
              <img data-bind="attr: { src: venue.photoURL }" alt="venue image" class="place-image">
              <i class="icon fa fa-caret-right" data-bind="click: function(data) { $parent.cyclePics('forwards', data) }"></i>
            </div>
          </div>

          <!-- yelp review -->
          <div class="yelp-review-wrapper" data-bind="visible: venue.review">
            <h6 class="yelp-title">Yelp Review:</h6>
            <p class="yelp-review" data-bind="text: venue.review"></p>
            <a class="yelp-link" data-bind="attr: { href: venue.yelpURL }">
              <i class="fa fa-share contact-icon"></i>
              <img class="yelp-logo" src="img/yelp-logo-xsmall@3x.png" alt="Yelp Logo">
            </a>
          </div>
        </section>
      </li>
    </ul>
  </section>

  <!-- login interface -->
  <aside class="login-wrapper" data-bind="css: { loginWrapperExpand: loginExpanded }">
    <button class="mode-button" data-bind="visible: !loginExpanded(), click: toggleLogin">
      <i class="fa fa-user mode-option login-icon"></i>
    </button>
    <form class="login-form" data-bind="visible: loginExpanded, submit: login" style="display:none">
      <button type="submit" class="login-button">
        <i class="fa fa-sign-in login-icon"></i>
      </button>
      <!-- login input -->
      <input class="login-input" type="text" data-bind="textInput: user, hasFocus: loginExpanded" placeholder="Create user or Login">
      <button class="login-button" data-bind="click: toggleLogin">
        <i class="fa fa-times login-icon"></i>
      </button>
    </form>
  </aside>

  <!-- settings interface -->
  <aside class="settings-wrapper">
    <form class="settings-form">
      <button class="mode-button" data-bind="click: toggleMapMode"><i class="fa fa-moon-o night-toggle mode-option" data-bind="visible: !currentMode()"></i><i class="fa fa-sun-o day-toggle mode-option" data-bind="visible: currentMode() === 'light'"></i>
      </button>
    </form>
  </aside>

  <!-- alert modal -->
  <aside class="alert-modal" data-bind="css: { alert: alerting } ">
    <div class="modal-body">
      <i class="alert-close fa fa-times" data-bind="click: toggleAlert"></i>
      <h3 class="alert-title" data-bind="text: alertTitle"></h3>
      <h5 class="alert-details" data-bind="text: alertDetails"></h5>
    </div>
  </aside>

  <!-- load scripts -->
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="http://maps.googleapis.com/maps/api/js?libraries=places"></script>
  <script src="http://knockoutjs.com/downloads/knockout-3.4.0.js"></script>
  <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
  <script src="bower_components/oauth-signature/dist/oauth-signature.min.js"></script>
  <script src="js/app.js"></script>

  <script>
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        var m = document.createElement('link'); m.rel = 'stylesheet';
        l.href = 'https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700';
        l.href = 'https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css';
        var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h); h.parentNode.insertBefore(m, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);
  </script>
</body>
</html>